<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải Pickleball Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Giải Pickleball Test</h1>
    <h2>Bảng xếp hạng</h2>
    <table id="standingsTable">
        <thead>
            <tr>
                <th>Tên</th>
                <th>Xếp hạng</th>
                <th>Thắng</th>
                <th>Thua</th>
                <th>Điểm</th>
                <th>Tỷ lệ thắng (%)</th>
            </tr>
        </thead>
        <tbody id="standingsBody"></tbody>
    </table>

    <h2>Trận đấu</h2>
    <table id="matchesTable">
        <thead>
            <tr>
                <th>Trận</th>
                <th>Đội 1</th>
                <th>Đội 2</th>
                <th>Tỷ số</th>
                <th>Người thắng</th>
            </tr>
        </thead>
        <tbody id="matchesBody"></tbody>
    </table>

   <script>
    async function fetchTournamentData() {
        const urlParams = new URLSearchParams(window.location.search);
        const tournamentId = urlParams.get('tournamentId');
        let apiUrl = 'https://sugyzhnavjttfmumpacw.supabase.co/rest/v1/tournaments?select=*';
        if (tournamentId) {
            apiUrl += `&id=eq.${tournamentId}`;
        }

        const anonKey = 'YOUR_ANON_KEY'; // Thay bằng key thực hoặc dùng biến môi trường
        try {
            const response = await fetch(apiUrl, {
                headers: {
                    'apikey': anonKey,
                    'Authorization': `Bearer ${anonKey}`
                }
            });
            if (!response.ok) throw new Error('Lỗi khi gọi API: ' + response.status);
            const data = await response.json();

            if (data.length === 0) {
                document.body.innerHTML += '<p>Không tìm thấy giải đấu!</p>';
                return;
            }

            // Hiển thị bảng xếp hạng
            const standingsBody = document.getElementById('standingsBody');
            data[0].data.Standings.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player.Name}</td>
                    <td>${player.Rank}</td>
                    <td>${player.Wins}</td>
                    <td>${player.Losses}</td>
                    <td>${player.Points}</td>
                    <td>${player.WinRate}</td>
                `;
                standingsBody.appendChild(row);
            });

            // Hiển thị danh sách trận đấu
            const matchesBody = document.getElementById('matchesBody');
            data[0].data.Matches.forEach(match => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${match.MatchNumber}</td>
                    <td>${match.Team1Player1} & ${match.Team1Player2}</td>
                    <td>${match.Team2Player1} & ${match.Team2Player2}</td>
                    <td>${match.Score1} - ${match.Score2}</td>
                    <td>${match.Winner}</td>
                `;
                matchesBody.appendChild(row);
            });
        } catch (error) {
            console.error('Lỗi:', error);
            document.body.innerHTML += `<p style="color: red;">Lỗi khi tải dữ liệu: ${error.message}</p>`;
        }
    }

    fetchTournamentData();
</script>
</body>
</html>

